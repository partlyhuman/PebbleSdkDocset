<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pebble SDK: AppSync</title>
  <link href='bootstrap.css' media='screen' rel='stylesheet' type='text/css' />
  <link href='pebble-developer.css' media='screen' rel='stylesheet' type='text/css' />
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30638158-4']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>
<body>
  <div id="top" ><!-- do not remove this div, it is closed by doxygen! -->
    <div class="navbar navbar-inverse ">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a class="first" href="#"><span></span></a></li>
              <li><a href="http://developer.getpebble.com/">Develop for Pebble</a></li>
            </ul>
            <ul class="nav pull-right">
              <li class="doc-nav-searchbox">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</li>
              <li><a href="http://forums.getpebble.com/">Forum</a></li>
              <li><a href="http://developer.getpebble.com/2/api-reference/modules.html">API Documentation</a></li>
              <li><a href="http://developer.getpebble.com/2/">Guides</a></li>
              <li><a href="http://developer.getpebble.com/blog/">Developer Blog</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___app_sync.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AppSync<div class="ingroups"><a class="el" href="group___foundation.html">Foundation</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>UI Synchronization layer for AppMessage. </p>
<p>AppSync is a thin layer on top of <a class="el" href="group___app_message.html">AppMessage</a>, to make it easier to drive the information displayed in the user interface of a watch app with messages sent by a phone app.</p>
<h3>Key Points</h3>
<ul>
<li>One callback to update the user interface, that is called whenever a <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> changes. See <a class="el" href="group___app_sync.html#ga448af36883189f6345cc7d5cd8a3cc29">AppSyncTupleChangedCallback</a>.</li>
<li>Manages storage and book keeping of the current <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> values: <a class="el" href="group___app_sync.html">AppSync</a> copies incoming <a class="el" href="group___app_message.html">AppMessage</a> Tuples into this "current" Dictionary, so that the key/values remain available for the user interface to use. For example, it is safe to use a C-string value provided by AppSync and use it directly in a <a class="el" href="group___text_layer.html#ga19406f772604d595c5c1af7222992449">text_layer_set_text()</a> call.</li>
<li>Your app needs to supply the buffer that AppSync uses for the "current" Dictionary when initializing AppSync.</li>
</ul>
<h3>Activity Diagram</h3>
<div class="image">
<img src="app_sync.png" alt="app_sync.png"/>
</div>
<p> Also see the activity diagram of the underlying <a class="el" href="group___app_message.html">AppMessage</a> subsystem.</p>
<h3>Example Project</h3>
<p>For a code example, see the sample project <code>demos/feature_app_messages</code>. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga87669e4513866da4328edd460a9417e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void app_sync_deinit </td>
          <td>(</td>
          <td class="paramtype">struct AppSync *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleans up an AppSync system. It frees the buffer allocated by an <a class="el" href="group___app_sync.html#ga329a8fa4a27bb8b15cee9ffcc4a026df">app_sync_init()</a> call and deregisters itself from the <a class="el" href="group___app_message.html">AppMessage</a> subsystem. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The AppSync context to deinit. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gafd27a0705ca3cb01f731f418b790c445"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="group___dictionary.html#struct_tuple">Tuple</a>* app_sync_get </td>
          <td>(</td>
          <td class="paramtype">const struct AppSync *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group___standard_c.html#gad53b3f685c3f3153f35ec87ea6f349d1">uint32_t</a>&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds and gets a tuple in the "current" dictionary. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The AppSync context </td></tr>
    <tr><td class="paramname">key</td><td>The key for which to find a <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to a found <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a>, or NULL if there was no <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> with the specified key. </dd></dl>

</div>
</div>
<a class="anchor" id="ga329a8fa4a27bb8b15cee9ffcc4a026df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void app_sync_init </td>
          <td>(</td>
          <td class="paramtype">struct AppSync *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group___standard_c.html#gabf6633e0fef9023e8a1e8d727f4023e1">uint16_t</a>&#160;</td>
          <td class="paramname"><em>buffer_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group___dictionary.html#struct_tuplet">Tuplet</a> *const&#160;</td>
          <td class="paramname"><em>keys_and_initial_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___app_sync.html#ga448af36883189f6345cc7d5cd8a3cc29">AppSyncTupleChangedCallback</a>&#160;</td>
          <td class="paramname"><em>tuple_changed_callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___app_sync.html#ga144a1a8d8050f8f279b11cfb5d526212">AppSyncErrorCallback</a>&#160;</td>
          <td class="paramname"><em>error_callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialized an AppSync system with specific buffer size and initial keys and values. The <code>callback.value_changed</code> callback will be called <b>asynchronously</b> with the initial keys and values, as to avoid duplicating code to update your app's UI. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The AppSync context to initialize </td></tr>
    <tr><td class="paramname">buffer</td><td>The buffer that AppSync should use </td></tr>
    <tr><td class="paramname">buffer_size</td><td>The size of the backing storage of the "current" dictionary. Use <a class="el" href="group___dictionary.html#gad31424a83643adbfd9e84c4bd37e4627">dict_calc_buffer_size_from_tuplets()</a> to estimate the size you need. </td></tr>
    <tr><td class="paramname">keys_and_initial_values</td><td>An array of Tuplets with the initial keys and values. </td></tr>
    <tr><td class="paramname">count</td><td>The number of Tuplets in the <code>keys_and_initial_values</code> array. </td></tr>
    <tr><td class="paramname">tuple_changed_callback</td><td>The callback that will handle changed key/value pairs </td></tr>
    <tr><td class="paramname">error_callback</td><td>The callback that will handle errors </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to app specific data that will get passed into calls to the callbacks </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Only updates for the keys specified in this initial array will be accepted by AppSync, updates for other keys that might come in will just be ignored. </dd></dl>

</div>
</div>
<a class="anchor" id="gaa5f51f1d7914b3617fdee104d1488108"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group___app_message.html#ga695a78c926b20edbb14d7faf5a78c29e">AppMessageResult</a> app_sync_set </td>
          <td>(</td>
          <td class="paramtype">struct AppSync *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group___dictionary.html#struct_tuplet">Tuplet</a> *const&#160;</td>
          <td class="paramname"><em>keys_and_values_to_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates key/value pairs using an array of Tuplets. </p>
<dl class="section note"><dt>Note</dt><dd>The call will attempt to send the updated keys and values to the application on the other end. Only after the other end has acknowledged the update, the <code>.value_changed</code> callback will be called to confirm the update has completed and your application code can update its user interface. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The AppSync context </td></tr>
    <tr><td class="paramname">keys_and_values_to_update</td><td>An array of Tuplets with the keys and values to update. The data in the Tuplets are copied during the call, so the array can be stack-allocated. </td></tr>
    <tr><td class="paramname">count</td><td>The number of Tuplets in the <code>keys_and_values_to_update</code> array. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The result code from the <a class="el" href="group___app_message.html">AppMessage</a> subsystem. Can be <a class="el" href="group___app_message.html#gga695a78c926b20edbb14d7faf5a78c29ea12a6ea49b151222e76cf4b99b7c0c4cc">APP_MSG_OK</a>, <a class="el" href="group___app_message.html#gga695a78c926b20edbb14d7faf5a78c29eaad6af2baa488efedd56b17f0ed1e8339">APP_MSG_BUSY</a> or <a class="el" href="group___app_message.html#gga695a78c926b20edbb14d7faf5a78c29eadfb91bdd9c369cc2eb00e019b4cf3846">APP_MSG_INVALID_ARGS</a> </dd></dl>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga144a1a8d8050f8f279b11cfb5d526212"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* AppSyncErrorCallback)(<a class="el" href="group___dictionary.html#gaafae887a6d07cde8d11885c755b55351">DictionaryResult</a> dict_error, <a class="el" href="group___app_message.html#ga695a78c926b20edbb14d7faf5a78c29e">AppMessageResult</a> app_message_error, void *context)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called whenever there was an error. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dict_error</td><td>The dictionary result error code, if the error was dictionary related. </td></tr>
    <tr><td class="paramname">app_message_error</td><td>The app_message result error code, if the error was app_message related. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to application specific data, as set using <a class="el" href="group___app_sync.html#ga329a8fa4a27bb8b15cee9ffcc4a026df">app_sync_init()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group___app_sync.html#ga329a8fa4a27bb8b15cee9ffcc4a026df">app_sync_init()</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ga448af36883189f6345cc7d5cd8a3cc29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* AppSyncTupleChangedCallback)(const <a class="el" href="group___standard_c.html#gad53b3f685c3f3153f35ec87ea6f349d1">uint32_t</a> key, const <a class="el" href="group___dictionary.html#struct_tuple">Tuple</a> *new_tuple, const <a class="el" href="group___dictionary.html#struct_tuple">Tuple</a> *old_tuple, void *context)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called whenever a <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> changes. This does not necessarily mean the value in the <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> has changed. When the internal "current" dictionary gets updated, existing Tuples might get shuffled around in the backing buffer, even though the values stay the same. In this callback, the client code gets the chance to remove the old reference and start using the new one. In this callback, you application MUST clean up any references to the <code>old_tuple</code> of a PREVIOUS call to this callback (and replace it with the <code>new_tuple</code> that is passed in with the current call). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>The key for which the <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> was changed. </td></tr>
    <tr><td class="paramname">new_tuple</td><td>The new tuple. The tuple points to the actual, updated "current" dictionary, as backed by the buffer internal to the AppSync struct. Therefore the <a class="el" href="group___dictionary.html#struct_tuple" title="Data structure for one serialized key/value tuple. ">Tuple</a> can be used after the callback returns, until the AppSync is deinited. In case there was an error (e.g. storage shortage), this <code>new_tuple</code> can be NULL_TUPLE. </td></tr>
    <tr><td class="paramname">old_tuple</td><td>The values that will be replaced with <code>new_tuple</code>. The key, value and type will be equal to the previous tuple in the old destination dictionary, however the <code>old_tuple</code> points to a stack-allocated copy of the old data. This value will be NULL_TUPLE when the initial values are being set. </td></tr>
    <tr><td class="paramname">context</td><td>Pointer to application specific data, as set using <a class="el" href="group___app_sync.html#ga329a8fa4a27bb8b15cee9ffcc4a026df">app_sync_init()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group___app_sync.html#ga329a8fa4a27bb8b15cee9ffcc4a026df">app_sync_init()</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
</div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Nov 14 2013 17:45:39 for Pebble SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
